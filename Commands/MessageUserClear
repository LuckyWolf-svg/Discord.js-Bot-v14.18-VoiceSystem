import { Events } from 'discord.js';
import { sendLogEmbed } from '../Events/Logs/LogSettings.js';

export function registerMessageUserClearCommand(client) {
    client.on(Events.InteractionCreate, async interaction => {
        if (!interaction.isChatInputCommand()) return;
        
        if (interaction.commandName === 'clearuser') {
            if (!interaction.member.permissions.has('ManageMessages')) {
                return await interaction.reply({
                    content: 'âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸!',
                    ephemeral: true
                });
            }

            const user = interaction.options.getUser('user');
            const amount = interaction.options.getInteger('amount');

            try {
                await interaction.deferReply({ ephemeral: true });
                const messages = await interaction.channel.messages.fetch({ limit: 100 });
                const userMessages = messages.filter(msg => {
                    return msg.author.id === user.id && 
                           Date.now() - msg.createdTimestamp < 14 * 24 * 60 * 60 * 1000;
                }).first(amount);

                if (userMessages.length === 0) {
                    return await interaction.editReply({
                        content: `âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ${user} Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.`
                    });
                }

                await interaction.channel.bulkDelete(userMessages, true);

                await sendLogEmbed(client,
                    'ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ',
                    `Ğ‘Ñ‹Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğµ`,
                    '#FFA500',
                    [
                        { name: 'ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€', value: `${interaction.user} (ID: ${interaction.user.id})`, inline: true },
                        { name: 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ', value: `${user} (ID: ${user.id})`, inline: true },
                        { name: 'ĞšĞ°Ğ½Ğ°Ğ»', value: `${interaction.channel}`, inline: true },
                        { name: 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹', value: `${userMessages.length}`, inline: true }
                    ]
                );

                await interaction.editReply({
                    content: `âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾ ${userMessages.length} ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ${user}!`
                });

            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:', error);
                await interaction.editReply({
                    content: 'âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹!'
                });
            }
        }
    });
}
